<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>Molly Label ÊùêË≥™ÂàáÊèõ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #ui {
        position: fixed;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
      }
      button {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        background: rgba(255,255,255,0.85);
        font-size: 14px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <a-scene
      renderer="colorManagement: true; physicallyCorrectLights: true;"
      xr-mode-ui="enabled: true"
      arjs="sourceType: webcam; debugUIEnabled: false;">

      <!-- Áí∞Â¢ÉÂÖâËàáÊñπÂêëÂÖâ -->
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 1" position="1 3 2"></a-entity>

      <!-- Molly Ê®°Âûã -->
      <a-entity id="molly"
        position="0 0 -1"
        scale="0.8 0.8 0.8"
        gltf-model="url(molly.glb)">
      </a-entity>
    </a-scene>

    <!-- UI ÊéßÂà∂ -->
    <div id="ui">
      <button onclick="setLabelTexture('textures/tex1.jpg')">Ê®£Âºè 1</button>
      <button onclick="setLabelTexture('textures/tex5.jpg')">Ê®£Âºè 5</button>
      <button onclick="setLabelTexture('textures/tex9.jpg')">Ê®£Âºè 9</button>
    </div>

    <script>
      const loader = new THREE.TextureLoader();
      const targetMatName = "Label_Default.008"; // üëà ÈÄôË£°ÊèõÊàê‰Ω†ÁöÑ label Â∞çÊáâÊùêË≥™ÂêçÁ®±

      function getLabelMesh() {
        const molly = document.querySelector('#molly').getObject3D('mesh');
        if (!molly) return null;

        let targetNodes = [];
        molly.traverse(node => {
          if (node.isMesh && node.material && node.material.name === targetMatName) {
            targetNodes.push(node);
          }
        });
        return targetNodes;
      }

      function setLabelTexture(imgFile) {
        const labelParts = getLabelMesh();
        if (labelParts.length === 0) {
          console.warn("Êâæ‰∏çÂà∞Â∞çÊáâÊùêË≥™:", targetMatName);
          return;
        }

        const tex = loader.load(imgFile, t => { t.flipY = false; });

        labelParts.forEach(node => {
          node.material.map = tex;
          node.material.needsUpdate = true;
        });
      }
    </script>
  </body>
</html>
